//// ------------------------------------------------------
//// THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
//// ------------------------------------------------------

Table PublicUser {
  id String [pk]
  nic String [unique, not null]
  name String [not null]
  phone String [not null]
  complaints Complaint [not null]
}

Table User {
  id String [pk]
  name String [not null]
  officeId String
  office Office
  institutionId String
  institution Institution
  actions Action [not null]
  userRoles UserRole [not null]
}

Table UserRole {
  id String [pk]
  name String [not null]
  users User [not null]
}

Table Complaint {
  id Int [pk, increment]
  complaint_title String
  complaint_description String
  complainerId String
  complainer PublicUser
  assignedInstitutionId String
  assignedInstitution Institution
  investigation Investigation
}

Table Institution {
  id String [pk]
  name String [not null]
  complaints Complaint [not null]
  investigations Investigation [not null]
  users User [not null]
  workflows Workflow [not null]
  offices Office [not null]
}

Table Office {
  id String [pk]
  name String [not null]
  description String
  type OfficeType [not null]
  instiutionId String [not null]
  institution Institution [not null]
  users User [not null]
  assignedInvestigations Investigation [not null]
  involvedInvestigations Investigation [not null]
  workflows Workflow [not null]
  offices Office [not null]
  office Office
  officeId String
}

Table Workflow {
  id Int [pk, increment]
  name String [not null]
  description String
  stages Json
  institutionId String [not null]
  institution Institution [not null]
  officeId String
  office Office
  investigations Investigation [not null]
}

Table Investigation {
  id Int [pk, increment]
  status InvestigationStatus [not null, default: 'NotAssigned']
  description String
  workflow Json
  complaintId Int [unique]
  complaint Complaint
  institutionId String [not null]
  institution Institution [not null]
  officeId String
  office Office
  institutionWorkflowId Int
  institutionWorkflow Workflow
  investigationStages InvestigationStage [not null]
  involvedParties Office [not null]
}

Table InvestigationStage {
  id Int [pk, increment]
  stageName String [not null]
  description String
  order Int [not null]
  tasks Json
  investigationId Int [not null]
  investigation Investigation [not null]
  actions Action [not null]
  status String [not null, default: 'Pending']
}

Table Action {
  id Int [pk, increment]
  investigationStage InvestigationStage
  investigationStageId Int
  name String [not null]
  description String
  user User [not null]
  userId String [unique, not null]
}

Enum OfficeType {
  Division
  Branch
  BeatOffice
}

Enum InvestigationStatus {
  NotAssigned
  Ongoing
  Completed
}

Ref: User.officeId > Office.id [delete: Set Null]

Ref: User.institutionId > Institution.id [delete: Set Null]

Ref: Complaint.complainerId > PublicUser.id [delete: Set Null]

Ref: Complaint.assignedInstitutionId > Institution.id [delete: Set Null]

Ref: Office.instiutionId > Institution.id [delete: Cascade]

Ref: Office.officeId > Office.id

Ref: Workflow.institutionId > Institution.id

Ref: Workflow.officeId > Office.id

Ref: Investigation.complaintId - Complaint.id [delete: Set Null]

Ref: Investigation.institutionId > Institution.id

Ref: Investigation.officeId > Office.id [delete: Set Null]

Ref: Investigation.institutionWorkflowId > Workflow.id [delete: Cascade]

Ref: InvestigationStage.investigationId > Investigation.id [delete: Cascade]

Ref: Action.investigationStageId > InvestigationStage.id [delete: Cascade]

Ref: Action.userId > User.id